<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多维度追踪看板</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding-top: 50px;
            overflow-x: hidden;
        }

        /* 顶部导航栏 - 合并标题 */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            padding: 8px 0;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 0 20px;
            position: relative;
        }

        .nav-left {
            position: absolute;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-title {
            font-size: 18px;
            font-weight: bold;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .board-title-nav {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            padding: 4px 0;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .nav-button {
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: #e8e8e8;
            color: #666;
            position: relative;
        }

        .nav-button:hover {
            color: #16a34a;
            background: rgba(34, 197, 94, 0.15);
        }

        .nav-button.active {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }

        .nav-button.active:hover {
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);
            transform: translateY(-1px);
        }

        /* 页面容器 */
        .page {
            display: none;
            padding: 12px;
            height: calc(100vh - 50px);
            overflow: hidden;
        }

        .page.active {
            display: block;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            height: 100%; /* 确保容器占满父元素高度 */
        }

        .board-section {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .board-content {
            display: grid;
            grid-template-columns: 260px 1fr 260px;
            gap: 12px;
            margin-bottom: 0;
            flex: 1;
            min-height: 0; /* 关键：允许 grid item 缩小 */
        }

        .input-panel {
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow: hidden; /* 防止内容溢出 */
        }

        .center-panel {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #fafafa;
            border-radius: 8px;
            padding: 15px;
            position: relative;
            justify-content: center;
            align-items: center;
        }

        .center-panel canvas {
            width: 100% !important;
            height: 100% !important;
        }

        .right-panel {
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
            flex-shrink: 0;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 1px solid #ddd;
            flex-shrink: 0;
        }

        .input-section {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            overflow-y: auto;
            flex: 1;
        }

        .input-section.full-height {
            flex: 1;
            height: 100%;
        }

        .stats-section {
            flex-shrink: 0;
        }

        .form-group {
            margin-bottom: 8px;
        }

        .form-group label {
            display: block;
            margin-bottom: 4px;
            color: #444;
            font-weight: 600;
            font-size: 12px;
            line-height: 1.3;
        }

        .form-group input {
            width: 100%;
            padding: 6px 10px;
            border: 1.5px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
            font-weight: 600;
            transition: border-color 0.2s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .dimension-inputs {
            display: grid;
            grid-template-columns: 1fr;
            gap: 6px;
        }

        .dimension-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 6px 10px;
            border-radius: 5px;
            border: 1px solid #eee;
        }

        .dimension-item label {
            flex: 1;
            font-size: 12px;
            font-weight: 600;
            color: #333;
            margin: 0;
            line-height: 1.3;
        }

        .dimension-item input {
            width: 60px;
            padding: 4px 8px;
            border: 1.5px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
        }

        .dimension-item input:focus {
            outline: none;
            border-color: #667eea;
        }

        .records-section {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            overflow-y: auto;
            flex: 1; /* 占据右列剩余空间 */
            display: flex;
            flex-direction: column;
            margin-top: 10px;
            min-height: 0; /* 允许收缩 */
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 强制双列 */
            gap: 8px;
        }

        .stat-card {
            background: white;
            padding: 6px;
            border-radius: 5px;
            text-align: center;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.2s;
        }

        .stat-card:hover {
            background: #f0f4ff;
            border-color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(102, 126, 234, 0.2);
        }

        /* 折线图模态框 */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0 5px;
            line-height: 1;
        }

        .modal-close:hover {
            color: #333;
        }

        .modal-chart {
            height: 350px;
        }

        .stat-label {
            font-size: 13px;
            font-weight: 600;
            color: #666;
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .stat-change {
            font-size: 11px;
            margin-top: 4px;
        }

        .stat-change.positive {
            color: #10b981;
        }

        .stat-change.negative {
            color: #ef4444;
        }

        .stat-change.neutral {
            color: #666;
        }

        .records-list {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #e0e0e0;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            max-height: 120px;
        }

        .records-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
            color: #333;
        }

        .records-container {
            overflow-y: auto;
            flex: 1;
        }

        .record-item {
            background: white;
            padding: 6px 8px;
            border-radius: 4px;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 6px;
            border: 1px solid #eee;
            flex-wrap: nowrap;
            transition: all 0.2s;
        }

        .record-item .record-content {
            cursor: pointer;
        }

        .record-item:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .record-item.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .record-item.selected .record-date {
            color: #667eea;
        }

        .record-content {
            flex: 1;
            min-width: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .record-summary {
            font-size: 11px;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .record-date {
            font-weight: 600;
            color: #333;
            font-size: 13px;
            white-space: nowrap;
        }

        .record-values {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 4px;
        }

        .record-dimension {
            font-size: 11px;
            color: #666;
            background: #f0f0f0;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .record-dimension span {
            font-weight: 600;
            color: #667eea;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
            padding: 4px 10px;
            font-size: 11px;
            flex-shrink: 0;
            width: auto !important;
            margin-top: 0 !important;
            border-radius: 4px;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* 按钮样式 */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);
            transform: translateY(-1px);
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
        }

        /* 管理图标按钮 */
        .nav-manage-btn {
            position: absolute;
            right: 20px;
            width: 36px;
            height: 36px;
            border: none;
            background: #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .nav-manage-btn:hover {
            background: rgba(34, 197, 94, 0.15);
        }

        .nav-manage-btn svg {
            width: 20px;
            height: 20px;
            stroke: #666;
            transition: stroke 0.3s;
        }

        .nav-manage-btn:hover svg {
            stroke: #16a34a;
        }

        /* 管理面板模态框 */
        .manage-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .manage-modal.active {
            display: flex;
        }

        .manage-panel {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
        }

        .manage-header {
            padding: 20px 24px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .manage-title {
            font-size: 20px;
            font-weight: 700;
            color: #333;
        }

        .manage-close {
            width: 32px;
            height: 32px;
            border: none;
            background: #f5f5f5;
            border-radius: 8px;
            cursor: pointer;
            font-size: 20px;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .manage-close:hover {
            background: #ef4444;
            color: white;
        }

        .manage-tabs {
            display: flex;
            border-bottom: 1px solid #eee;
            padding: 0 24px;
        }

        .manage-tab {
            padding: 12px 20px;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            position: relative;
            transition: color 0.3s;
        }

        .manage-tab:hover {
            color: #16a34a;
        }

        .manage-tab.active {
            color: #16a34a;
        }

        .manage-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 20px;
            right: 20px;
            height: 2px;
            background: #16a34a;
            border-radius: 2px 2px 0 0;
        }

        .manage-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px 24px;
        }

        .manage-section {
            display: none;
        }

        .manage-section.active {
            display: block;
        }

        /* 看板列表样式 */
        .board-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .board-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #eee;
            transition: all 0.2s;
        }

        .board-item:hover {
            border-color: #16a34a;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.15);
        }

        .board-item-info {
            flex: 1;
        }

        .board-item-name {
            font-size: 15px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .board-item-dims {
            font-size: 12px;
            color: #888;
        }

        .board-item-deleted-at {
            font-size: 11px;
            color: #ef4444;
            margin-top: 4px;
        }

        .board-item-actions {
            display: flex;
            gap: 8px;
        }

        .board-item-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .board-item-btn.delete {
            background: #fee2e2;
            color: #dc2626;
        }

        .board-item-btn.delete:hover {
            background: #ef4444;
            color: white;
        }

        .board-item-btn.restore {
            background: #dcfce7;
            color: #16a34a;
        }

        .board-item-btn.restore:hover {
            background: #22c55e;
            color: white;
        }

        .board-item-btn.permanent {
            background: #fef3c7;
            color: #d97706;
        }

        .board-item-btn.permanent:hover {
            background: #f59e0b;
            color: white;
        }

        /* 创建看板表单 */
        .create-form {
            margin-bottom: 24px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.05) 0%, rgba(22, 163, 74, 0.05) 100%);
            border-radius: 12px;
            border: 1px dashed #22c55e;
        }

        .create-form-title {
            font-size: 16px;
            font-weight: 600;
            color: #16a34a;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .create-form-group {
            margin-bottom: 16px;
        }

        .create-form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #555;
            margin-bottom: 6px;
        }

        .create-form-input {
            width: 100%;
            padding: 10px 14px;
            border: 1.5px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .create-form-input:focus {
            outline: none;
            border-color: #22c55e;
        }

        .dimension-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .dimension-tag {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 13px;
            color: #333;
        }

        .dimension-tag-remove {
            width: 16px;
            height: 16px;
            border: none;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .add-dimension-row {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .add-dimension-row input {
            flex: 1;
            padding: 8px 12px;
            border: 1.5px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
        }

        .add-dimension-row input:focus {
            outline: none;
            border-color: #22c55e;
        }

        .add-dimension-btn {
            padding: 8px 16px;
            background: #22c55e;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .add-dimension-btn:hover {
            background: #16a34a;
        }

        .create-submit-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .create-submit-btn:hover {
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
            transform: translateY(-1px);
        }

        .create-submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #888;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-state-text {
            font-size: 14px;
        }

        /* ==================== 移动端适配 ==================== */
        @media (max-width: 768px) {
            /* 导航栏调整 */
            .nav-container {
                flex-wrap: wrap;
                gap: 8px;
                padding: 8px 12px;
            }

            .nav-left {
                position: static;
                width: 100%;
                justify-content: center;
                margin-bottom: 4px;
            }

            .nav-title {
                display: none; /* 手机端隐藏大标题 */
            }

            .nav-buttons {
                flex-wrap: wrap;
                justify-content: center;
                gap: 6px;
            }

            .nav-button {
                padding: 6px 12px;
                font-size: 12px;
            }

            .nav-manage-btn {
                position: static;
            }

            body {
                padding-top: 100px; /* 增加顶部空间 */
            }

            /* 三列布局改为单列 */
            .board-content {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .page {
                padding: 8px;
                height: auto;
                min-height: calc(100vh - 100px);
                overflow-y: auto;
            }

            .board-section {
                height: auto;
                overflow: visible;
            }

            /* 雷达图区域 - 增大显示 */
            .center-panel {
                min-height: 480px;
                order: -1; /* 雷达图放最上面 */
                padding: 25px 15px 55px 15px; /* 四周留空间给标签和图例 */
            }

            .center-panel canvas {
                max-width: 100%;
                max-height: 400px;
            }

            /* 输入区域 */
            .input-panel {
                order: 0;
            }

            /* 右侧统计和记录 */
            .right-panel {
                order: 1;
            }

            /* 统计卡片 */
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .stat-card {
                padding: 8px 4px;
            }

            .stat-label {
                font-size: 11px;
            }

            .stat-value {
                font-size: 16px;
            }

            /* 历史记录 */
            .records-list {
                max-height: 200px;
            }
        }

        /* 更小的屏幕 */
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .board-title-nav {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- 顶部导航栏 - 合并标题 -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <div class="nav-title">多维度追踪看板</div>
                <div class="board-title-nav" id="current-board-title">边界感六维</div>
            </div>
            <div class="nav-buttons" id="nav-buttons-container">
                <!-- 动态生成看板按钮 -->
            </div>
            <button class="nav-manage-btn" onclick="openManagePanel()" title="管理看板">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="4" y1="6" x2="20" y2="6"></line>
                    <line x1="4" y1="12" x2="20" y2="12"></line>
                    <line x1="4" y1="18" x2="20" y2="18"></line>
                </svg>
            </button>
        </div>
    </nav>

    <!-- 动态生成的看板页面会插入到这里 -->

<script>
        // API 基础URL
        const API_BASE = '';

        // 存储看板数据
        let boards = [];
        let charts = {};
        let currentPageIndex = 0;
        let newDimensions = []; // 新建看板时的维度列表

        // 页面切换函数
        function switchPage(pageIndex) {
            if (pageIndex < 0 || pageIndex >= boards.length) return;
            currentPageIndex = pageIndex;

            // 隐藏所有页面
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            // 显示选中的页面
            const pageEl = document.getElementById(`page-${boards[pageIndex].id}`);
            if (pageEl) {
                pageEl.classList.add('active');
            }

            // 更新导航按钮状态
            document.querySelectorAll('#nav-buttons-container .nav-button').forEach((btn, index) => {
                if (index === pageIndex) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            // 更新导航栏中的看板标题
            document.getElementById('current-board-title').textContent = boards[pageIndex].name;

            // 触发图表动画重播
            const boardId = boards[pageIndex].id;
            const chart = charts[boardId];
            if (chart) {
                setTimeout(() => {
                    chart.reset();
                    chart.update();
                }, 50);
            }
        }

        // 渲染导航按钮
        function renderNavButtons() {
            const container = document.getElementById('nav-buttons-container');
            container.innerHTML = '';
            boards.forEach((board, index) => {
                const btn = document.createElement('button');
                btn.className = 'nav-button' + (index === currentPageIndex ? ' active' : '');
                btn.textContent = board.name;
                btn.onclick = () => switchPage(index);
                container.appendChild(btn);
            });
        }

        // 渲染所有页面
        function renderPages() {
            // 移除已有的动态页面
            document.querySelectorAll('.page.dynamic-page').forEach(p => p.remove());

            boards.forEach((board, index) => {
                let pageEl = document.getElementById(`page-${board.id}`);
                if (!pageEl) {
                    pageEl = createBoardPage(board);
                    document.body.insertBefore(pageEl, document.getElementById('line-chart-modal'));
                }
                pageEl.classList.toggle('active', index === currentPageIndex);
            });
        }

        // 创建看板页面 HTML
        function createBoardPage(board) {
            const page = document.createElement('div');
            page.className = 'page dynamic-page';
            page.id = `page-${board.id}`;
            page.innerHTML = `
                <div class="container">
                    <div class="board-section" id="board-${board.id}">
                        <div class="board-content">
                            <!-- 左列：每日记录 -->
                            <div class="input-panel">
                                <div class="input-section full-height">
                                    <div class="section-title">每日记录</div>
                                    <form id="form-board-${board.id}">
                                        <div class="form-group">
                                            <label>日期</label>
                                            <input type="date" id="date-board-${board.id}" required>
                                        </div>
                                        <div class="dimension-inputs" id="dimensions-board-${board.id}">
                                            <!-- 动态生成维度输入框 -->
                                        </div>
                                        <button type="submit" class="btn btn-primary">保存记录</button>
                                    </form>
                                </div>
                            </div>
                            <!-- 中列：雷达图 -->
                            <div class="center-panel">
                                <canvas id="chart-board-${board.id}"></canvas>
                            </div>
                            <!-- 右列：统计 + 历史记录 -->
                            <div class="right-panel">
                                <div class="stats-section">
                                    <div class="section-title">本周统计</div>
                                    <div class="stats-grid" id="stats-board-${board.id}">
                                        <!-- 动态生成统计卡片 -->
                                    </div>
                                </div>
                                <div class="records-section">
                                    <div class="section-title">历史记录</div>
                                    <div class="records-container" id="records-board-${board.id}">
                                        <div class="loading">加载中...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            return page;
        }

        // 初始化应用
        async function init() {
            try {
                // 加载看板列表
                const response = await fetch(`${API_BASE}/boards`);
                boards = await response.json();
                
                // 渲染导航和页面
                renderNavButtons();
                renderPages();
                
                // 为每个看板初始化
                for (let i = 0; i < boards.length; i++) {
                    const board = boards[i];
                    await initBoardDynamic(board);
                }
                
                // 默认显示第一个
                if (boards.length > 0) {
                    switchPage(0);
                }
            } catch (error) {
                console.error('初始化失败:', error);
                showError('加载数据失败，请刷新页面重试');
            }
        }
        
        // 动态初始化单个看板
        async function initBoardDynamic(board) {
            const boardId = board.id;
            const boardPrefix = `board-${boardId}`;

            // 设置默认日期为今天
            const dateInput = document.getElementById(`date-${boardPrefix}`);
            if (dateInput) {
                dateInput.value = new Date().toISOString().split('T')[0];
            }

            // 生成维度输入框
            const dimensionsContainer = document.getElementById(`dimensions-${boardPrefix}`);
            if (dimensionsContainer) {
                dimensionsContainer.innerHTML = '';
                board.dimensions.forEach(dim => {
                    const div = document.createElement('div');
                    div.className = 'dimension-item';
                    div.innerHTML = `
                        <label>${dim}</label>
                        <input type="number" 
                               min="0" 
                               max="10" 
                               step="1" 
                               data-dimension="${dim}" 
                               placeholder="0-10"
                               required>
                    `;
                    dimensionsContainer.appendChild(div);
                });
            }

            // 绑定表单提交事件
            const form = document.getElementById(`form-${boardPrefix}`);
            if (form) {
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await saveRecord(boardId, boardPrefix);
                });
            }

            // 初始化雷达图
            initChartDynamic(board, boardPrefix);

            // 加载统计数据
            await loadWeeklyStats(boardId, boardPrefix);

            // 加载历史记录
            await loadRecords(boardId, boardPrefix);
        }
        
        // 检测是否为移动端
        function isMobile() {
            return window.innerWidth <= 768;
        }

        // 动态初始化雷达图
        function initChartDynamic(board, boardPrefix) {
            const ctx = document.getElementById(`chart-${boardPrefix}`);
            if (!ctx) return;

            const mobile = isMobile();
            
            // 根据屏幕大小调整配置
            const fontSize = mobile ? 11 : 12;
            const dataLabelFontSize = mobile ? 14 : 16;
            const dataLabelRadius = mobile ? 25 : 20;
            const pointRadius = mobile ? 4 : 5;
            const legendFontSize = mobile ? 11 : 12;
            const legendBoxWidth = mobile ? 10 : 12;
            const legendPadding = mobile ? 8 : 15;
            const layoutPadding = mobile ? { top: 15, bottom: 15, left: 15, right: 15 } : { top: 10, bottom: 10, left: 10, right: 10 };

            charts[board.id] = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: board.dimensions,
                    datasets: [
                        {
                            label: '本周平均值',
                            data: board.dimensions.map(() => 0),
                            borderColor: 'rgb(102, 126, 234)',
                            backgroundColor: 'rgba(102, 126, 234, 0.2)',
                            pointBackgroundColor: 'rgb(102, 126, 234)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgb(102, 126, 234)',
                            borderWidth: 3,
                            pointRadius: pointRadius,
                            pointHoverRadius: pointRadius + 2
                        },
                        {
                            label: '上周平均值',
                            data: board.dimensions.map(() => 0),
                            borderColor: 'rgb(239, 68, 68)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            pointBackgroundColor: 'rgb(239, 68, 68)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgb(239, 68, 68)',
                            borderWidth: 2,
                            pointRadius: pointRadius - 1,
                            pointHoverRadius: pointRadius + 1,
                            borderDash: [5, 5]
                        }
                    ]
                },
                plugins: [{
                    id: 'dataLabels',
                    afterDatasetsDraw(chart, args, options) {
                        const { ctx, data } = chart;
                        const blueVisible = chart.isDatasetVisible(0);
                        const redVisible = chart.isDatasetVisible(1);
                        let targetDatasetIndex = -1;
                        let labelColor = '';
                        
                        if (blueVisible && redVisible) {
                            targetDatasetIndex = 0;
                            labelColor = '#667eea';
                        } else if (blueVisible && !redVisible) {
                            targetDatasetIndex = 0;
                            labelColor = '#667eea';
                        } else if (!blueVisible && redVisible) {
                            targetDatasetIndex = 1;
                            labelColor = '#ef4444';
                        }
                        
                        if (targetDatasetIndex === -1) return;
                        
                        const dataset = data.datasets[targetDatasetIndex];
                        const meta = chart.getDatasetMeta(targetDatasetIndex);
                        
                        // 移动端使用更大字体
                        const currentFontSize = window.innerWidth <= 768 ? 14 : 16;
                        ctx.save();
                        ctx.font = `bold ${currentFontSize}px "Microsoft YaHei", sans-serif`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillStyle = labelColor;
                        
                        meta.data.forEach((point, index) => {
                            const value = dataset.data[index];
                            if (value !== undefined && value !== null && value > 0) {
                                const angle = Math.atan2(point.y - chart.scales.r.yCenter, point.x - chart.scales.r.xCenter);
                                const currentRadius = window.innerWidth <= 768 ? 25 : 20;
                                const x = point.x + Math.cos(angle) * currentRadius;
                                const y = point.y + Math.sin(angle) * currentRadius;
                                ctx.fillText(value.toFixed(1), x, y);
                            }
                        });
                        ctx.restore();
                    }
                }],
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: layoutPadding
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 2,
                                display: true,
                                color: '#666',
                                font: { size: mobile ? 9 : 10 },
                                backdropColor: 'rgba(255, 255, 255, 0.7)',
                                showLabelBackdrop: true
                            },
                            grid: {
                                color: 'rgba(102, 126, 234, 0.3)',
                                lineWidth: 1.5,
                                circular: true
                            },
                            angleLines: {
                                color: 'rgba(102, 126, 234, 0.3)',
                                lineWidth: 1.5
                            },
                            pointLabels: {
                                font: {
                                    size: mobile ? 10 : fontSize,
                                    weight: 'bold',
                                    family: "'Microsoft YaHei', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial"
                                },
                                color: '#333',
                                padding: mobile ? 15 : 8,
                                callback: function(label) {
                                    // 移动端：长标签智能换行
                                    if (window.innerWidth <= 768 && label.length > 6) {
                                        // 尝试在中间位置换行，最多2行
                                        const mid = Math.ceil(label.length / 2);
                                        return [label.substring(0, mid), label.substring(mid)];
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                boxWidth: legendBoxWidth,
                                padding: legendPadding,
                                font: { size: legendFontSize, weight: 'bold' }
                            }
                        }
                    }
                }
            });
        }

        // 保存记录
        async function saveRecord(boardId, boardPrefix) {
            try {
                const dateInput = document.getElementById(`date-${boardPrefix}`);
                const dimensionInputs = document.querySelectorAll(`#dimensions-${boardPrefix} input[data-dimension]`);
                
                const values = {};
                dimensionInputs.forEach(input => {
                    const dim = input.getAttribute('data-dimension');
                    values[dim] = parseFloat(input.value) || 0;
                });

                const recordData = {
                    board_id: boardId,
                    record_date: dateInput.value,
                    values: values
                };

                const response = await fetch(`${API_BASE}/records`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(recordData)
                });

                if (response.ok) {
                    alert('记录保存成功！');
                    // 重新加载数据和图表
                    await loadWeeklyStats(boardId, boardPrefix);
                    await loadRecords(boardId, boardPrefix);
                    updateChart(boardId, boardPrefix);
                } else {
                    throw new Error('保存失败');
                }
            } catch (error) {
                console.error('保存记录失败:', error);
                alert('保存失败，请重试');
            }
        }

        // 更新雷达图（同时更新本周和上周数据）
        async function updateChart(boardId, boardPrefix) {
            try {
                const stats = await fetch(`${API_BASE}/boards/${boardId}/weekly-stats`).then(r => r.json());
                if (charts[boardId]) {
                    // 本周数据
                    charts[boardId].data.datasets[0].data = stats.averages ? 
                        Object.values(stats.averages) : 
                        charts[boardId].data.labels.map(() => 0);
                    // 上周数据
                    charts[boardId].data.datasets[1].data = stats.last_week_averages ? 
                        Object.values(stats.last_week_averages) : 
                        charts[boardId].data.labels.map(() => 0);
                    charts[boardId].update();
                }
            } catch (error) {
                console.error('更新图表失败:', error);
            }
        }

        // 加载每周统计
        async function loadWeeklyStats(boardId, boardPrefix) {
            try {
                const response = await fetch(`${API_BASE}/boards/${boardId}/weekly-stats`);
                const stats = await response.json();

                // 更新图表（本周 + 上周）
                if (charts[boardId]) {
                    // 本周数据（蓝色）
                    charts[boardId].data.datasets[0].data = Object.values(stats.averages);
                    // 上周数据（红色）
                    if (stats.last_week_averages) {
                        charts[boardId].data.datasets[1].data = Object.values(stats.last_week_averages);
                    } else {
                        charts[boardId].data.datasets[1].data = charts[boardId].data.labels.map(() => 0);
                    }
                    charts[boardId].update();
                }

                // 显示统计卡片
                const statsContainer = document.getElementById(`stats-${boardPrefix}`);
                statsContainer.innerHTML = '';

                const board = boards.find(b => b.id === boardId);
                board.dimensions.forEach(dim => {
                    const avg = stats.averages[dim] || 0;
                    const change = stats.changes ? stats.changes[dim] : null;

                    const card = document.createElement('div');
                    card.className = 'stat-card';
                    card.title = '点击查看趋势';
                    card.onclick = () => showDimensionHistory(boardId, dim);
                    
                    let changeHtml = '';
                    if (change !== null) {
                        const changeClass = change > 0 ? 'positive' : change < 0 ? 'negative' : 'neutral';
                        const changeSymbol = change > 0 ? '+' : '';
                        changeHtml = `<div class="stat-change ${changeClass}">${changeSymbol}${change.toFixed(1)} vs 上周</div>`;
                    }

                    card.innerHTML = `
                        <div class="stat-label">${dim}</div>
                        <div class="stat-value">${avg.toFixed(1)}</div>
                        ${changeHtml}
                    `;
                    statsContainer.appendChild(card);
                });
            } catch (error) {
                console.error('加载统计失败:', error);
            }
        }

        // 加载历史记录
        async function loadRecords(boardId, boardPrefix) {
            try {
                const response = await fetch(`${API_BASE}/records?board_id=${boardId}`);
                const records = await response.json();

                const recordsContainer = document.getElementById(`records-${boardPrefix}`);
                
                if (records.length === 0) {
                    recordsContainer.innerHTML = '<div class="loading">暂无记录</div>';
                    return;
                }

                recordsContainer.innerHTML = '';
                records.forEach(record => {
                    const item = document.createElement('div');
                    item.className = 'record-item';
                    item.dataset.recordId = record.id;
                    
                    const dateStr = new Date(record.record_date).toLocaleDateString('zh-CN');
                    // 计算平均值作为摘要
                    const values = Object.values(record.values);
                    const avg = values.length > 0 ? (values.reduce((a, b) => a + b, 0) / values.length).toFixed(1) : 0;

                    item.innerHTML = `
                        <div class="record-content" onclick="toggleRecordChart(${boardId}, '${boardPrefix}', ${JSON.stringify(record.values).replace(/"/g, '&quot;')}, '${dateStr}', this.parentElement)">
                            <span class="record-date">${dateStr}</span>
                            <span class="record-summary">均值: ${avg}</span>
                        </div>
                        <button class="btn btn-delete" onclick="event.stopPropagation(); deleteRecord(${record.id}, ${boardId}, '${boardPrefix}')">删除</button>
                    `;
                    recordsContainer.appendChild(item);
                });
            } catch (error) {
                console.error('加载记录失败:', error);
                document.getElementById(`records-${boardPrefix}`).innerHTML = 
                    '<div class="error">加载记录失败</div>';
            }
        }

        // 删除记录
        async function deleteRecord(recordId, boardId, boardPrefix) {
            if (!confirm('确定要删除这条记录吗？')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/records/${recordId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    await loadWeeklyStats(boardId, boardPrefix);
                    await loadRecords(boardId, boardPrefix);
                    updateChart(boardId, boardPrefix);
                } else {
                    throw new Error('删除失败');
                }
            } catch (error) {
                console.error('删除记录失败:', error);
                alert('删除失败，请重试');
            }
        }

        // 显示错误信息
        function showError(message) {
            const container = document.querySelector('.container');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            container.insertBefore(errorDiv, container.firstChild);
        }

        // 存储原始图表数据和当前选中的记录
        let originalChartData = {};
        let selectedRecordElement = null;

        // 切换显示单条记录的雷达图
        function toggleRecordChart(boardId, boardPrefix, recordValues, dateStr, itemElement) {
            const chart = charts[boardId];
            if (!chart) return;

            // 如果点击的是当前选中的记录，恢复原始图表
            if (selectedRecordElement === itemElement) {
                restoreOriginalChart(boardId);
                itemElement.classList.remove('selected');
                selectedRecordElement = null;
                return;
            }

            // 如果有其他选中的记录，先取消选中
            if (selectedRecordElement) {
                selectedRecordElement.classList.remove('selected');
            }

            // 保存原始数据（如果还没保存）
            if (!originalChartData[boardId]) {
                originalChartData[boardId] = {
                    data0: [...chart.data.datasets[0].data],
                    data1: [...chart.data.datasets[1].data],
                    label0: chart.data.datasets[0].label,
                    label1: chart.data.datasets[1].label
                };
            }

            // 更新图表显示单条记录
            const board = boards.find(b => b.id === boardId);
            const recordData = board.dimensions.map(dim => recordValues[dim] || 0);
            
            chart.data.datasets[0].data = recordData;
            chart.data.datasets[0].label = dateStr + ' 记录';
            chart.data.datasets[1].data = board.dimensions.map(() => 0); // 隐藏上周数据
            chart.data.datasets[1].label = '';
            
            chart.update();

            // 标记选中状态
            itemElement.classList.add('selected');
            selectedRecordElement = itemElement;
        }

        // 恢复原始图表
        function restoreOriginalChart(boardId) {
            const chart = charts[boardId];
            if (!chart || !originalChartData[boardId]) return;

            chart.data.datasets[0].data = originalChartData[boardId].data0;
            chart.data.datasets[0].label = originalChartData[boardId].label0;
            chart.data.datasets[1].data = originalChartData[boardId].data1;
            chart.data.datasets[1].label = originalChartData[boardId].label1;
            
            chart.update();
            delete originalChartData[boardId];
        }

        // 点击其他地方恢复图表
        document.addEventListener('click', function(e) {
            if (selectedRecordElement && !e.target.closest('.record-item')) {
                const boardId = Object.keys(originalChartData)[0];
                if (boardId) {
                    restoreOriginalChart(parseInt(boardId));
                    selectedRecordElement.classList.remove('selected');
                    selectedRecordElement = null;
                }
            }
        });

        // ==================== 折线图模态框功能 ====================
        let lineChart = null;

        // 显示维度历史折线图
        async function showDimensionHistory(boardId, dimension) {
            try {
                const response = await fetch(`${API_BASE}/boards/${boardId}/dimension-history?dimension=${encodeURIComponent(dimension)}&weeks=8`);
                const data = await response.json();

                // 显示模态框
                const modal = document.getElementById('line-chart-modal');
                modal.classList.add('active');
                document.getElementById('modal-dimension-title').textContent = dimension + ' - 周平均值趋势';

                // 准备图表数据
                const labels = data.history.map(h => h.week_label);
                const values = data.history.map(h => h.average);

                // 销毁旧图表
                if (lineChart) {
                    lineChart.destroy();
                }

                // 创建新图表
                const ctx = document.getElementById('line-chart-canvas');
                lineChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: dimension,
                            data: values,
                            borderColor: 'rgb(102, 126, 234)',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            pointBackgroundColor: 'rgb(102, 126, 234)',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 10,
                                ticks: {
                                    stepSize: 2,
                                    font: { size: 12, weight: 'bold' }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            x: {
                                ticks: {
                                    font: { size: 12, weight: 'bold' }
                                },
                                grid: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleFont: { size: 14 },
                                bodyFont: { size: 14 },
                                padding: 12,
                                callbacks: {
                                    label: function(context) {
                                        return '周平均: ' + context.raw.toFixed(1);
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('加载维度历史失败:', error);
                alert('加载数据失败，请重试');
            }
        }

        // 关闭模态框
        function closeModal() {
            const modal = document.getElementById('line-chart-modal');
            modal.classList.remove('active');
            if (lineChart) {
                lineChart.destroy();
                lineChart = null;
            }
        }

        // 点击模态框背景关闭
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                closeModal();
            }
        });

        // ESC 键关闭模态框
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // ==================== 看板管理功能 ====================
        
        // 打开管理面板
        function openManagePanel() {
            document.getElementById('manage-modal').classList.add('active');
            loadActiveBoardsList();
            switchManageTab('boards');
        }

        // 关闭管理面板
        function closeManagePanel() {
            document.getElementById('manage-modal').classList.remove('active');
            // 清空创建表单
            document.getElementById('new-board-name').value = '';
            newDimensions = [];
            renderNewDimensionsTags();
            updateCreateButtonState();
        }

        // 切换管理面板标签页
        function switchManageTab(tab) {
            document.querySelectorAll('.manage-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.manage-section').forEach(s => s.classList.remove('active'));
            
            if (tab === 'boards') {
                document.querySelector('.manage-tab:first-child').classList.add('active');
                document.getElementById('manage-boards').classList.add('active');
                loadActiveBoardsList();
            } else {
                document.querySelector('.manage-tab:last-child').classList.add('active');
                document.getElementById('manage-deleted').classList.add('active');
                loadDeletedBoardsList();
            }
        }

        // 加载活跃看板列表
        async function loadActiveBoardsList() {
            const list = document.getElementById('active-boards-list');
            list.innerHTML = '<div class="loading">加载中...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/boards`);
                const activeBoards = await response.json();
                
                if (activeBoards.length === 0) {
                    list.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">📋</div>
                            <div class="empty-state-text">暂无看板，请创建一个</div>
                        </div>
                    `;
                    return;
                }
                
                list.innerHTML = '';
                activeBoards.forEach(board => {
                    const item = document.createElement('div');
                    item.className = 'board-item';
                    item.innerHTML = `
                        <div class="board-item-info">
                            <div class="board-item-name">${board.name}</div>
                            <div class="board-item-dims">${board.dimensions.length} 个维度：${board.dimensions.slice(0, 3).join('、')}${board.dimensions.length > 3 ? '...' : ''}</div>
                        </div>
                        <div class="board-item-actions">
                            <button class="board-item-btn delete" onclick="deleteBoard(${board.id}, '${board.name}')">删除</button>
                        </div>
                    `;
                    list.appendChild(item);
                });
            } catch (error) {
                console.error('加载看板列表失败:', error);
                list.innerHTML = '<div class="error">加载失败</div>';
            }
        }

        // 加载已删除看板列表
        async function loadDeletedBoardsList() {
            const list = document.getElementById('deleted-boards-list');
            list.innerHTML = '<div class="loading">加载中...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/boards/deleted/list`);
                const deletedBoards = await response.json();
                
                if (deletedBoards.length === 0) {
                    list.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">🗑️</div>
                            <div class="empty-state-text">最近删除为空</div>
                        </div>
                    `;
                    return;
                }
                
                list.innerHTML = '';
                deletedBoards.forEach(board => {
                    const deletedAt = board.deleted_at ? new Date(board.deleted_at).toLocaleString('zh-CN') : '未知时间';
                    const item = document.createElement('div');
                    item.className = 'board-item';
                    item.innerHTML = `
                        <div class="board-item-info">
                            <div class="board-item-name">${board.name}</div>
                            <div class="board-item-dims">${board.dimensions.length} 个维度</div>
                            <div class="board-item-deleted-at">删除于 ${deletedAt}</div>
                        </div>
                        <div class="board-item-actions">
                            <button class="board-item-btn restore" onclick="restoreBoard(${board.id})">恢复</button>
                            <button class="board-item-btn permanent" onclick="permanentDeleteBoard(${board.id}, '${board.name}')">永久删除</button>
                        </div>
                    `;
                    list.appendChild(item);
                });
            } catch (error) {
                console.error('加载已删除看板列表失败:', error);
                list.innerHTML = '<div class="error">加载失败</div>';
            }
        }

        // 删除看板（软删除）
        async function deleteBoard(boardId, boardName) {
            if (!confirm(`确定要删除看板「${boardName}」吗？\n删除后可在"最近删除"中恢复。`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/boards/${boardId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    // 重新加载应用
                    await reloadApp();
                    loadActiveBoardsList();
                } else {
                    throw new Error('删除失败');
                }
            } catch (error) {
                console.error('删除看板失败:', error);
                alert('删除失败，请重试');
            }
        }

        // 恢复看板
        async function restoreBoard(boardId) {
            try {
                const response = await fetch(`${API_BASE}/boards/${boardId}/restore`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    await reloadApp();
                    loadDeletedBoardsList();
                } else {
                    throw new Error('恢复失败');
                }
            } catch (error) {
                console.error('恢复看板失败:', error);
                alert('恢复失败，请重试');
            }
        }

        // 永久删除看板
        async function permanentDeleteBoard(boardId, boardName) {
            if (!confirm(`⚠️ 确定要永久删除看板「${boardName}」吗？\n此操作不可恢复，所有相关数据将被清除！`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/boards/${boardId}/permanent`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    loadDeletedBoardsList();
                } else {
                    throw new Error('永久删除失败');
                }
            } catch (error) {
                console.error('永久删除看板失败:', error);
                alert('永久删除失败，请重试');
            }
        }

        // 添加新维度
        function addNewDimension() {
            const input = document.getElementById('new-dimension-input');
            const value = input.value.trim();
            
            if (!value) return;
            if (newDimensions.includes(value)) {
                alert('该维度已存在');
                return;
            }
            
            newDimensions.push(value);
            input.value = '';
            renderNewDimensionsTags();
            updateCreateButtonState();
        }

        // 处理维度输入框回车
        function handleDimensionKeypress(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                addNewDimension();
            }
        }

        // 移除维度
        function removeNewDimension(index) {
            newDimensions.splice(index, 1);
            renderNewDimensionsTags();
            updateCreateButtonState();
        }

        // 渲染新维度标签
        function renderNewDimensionsTags() {
            const container = document.getElementById('new-dimensions-tags');
            container.innerHTML = '';
            newDimensions.forEach((dim, index) => {
                const tag = document.createElement('div');
                tag.className = 'dimension-tag';
                tag.innerHTML = `
                    <span>${dim}</span>
                    <button class="dimension-tag-remove" onclick="removeNewDimension(${index})">×</button>
                `;
                container.appendChild(tag);
            });
        }

        // 更新创建按钮状态
        function updateCreateButtonState() {
            const nameInput = document.getElementById('new-board-name');
            const btn = document.getElementById('create-board-btn');
            btn.disabled = !nameInput.value.trim() || newDimensions.length < 2;
        }

        // 监听看板名称输入
        document.addEventListener('DOMContentLoaded', () => {
            const nameInput = document.getElementById('new-board-name');
            if (nameInput) {
                nameInput.addEventListener('input', updateCreateButtonState);
            }
        });

        // 创建新看板
        async function createNewBoard() {
            const name = document.getElementById('new-board-name').value.trim();
            
            if (!name) {
                alert('请输入看板名称');
                return;
            }
            if (newDimensions.length < 2) {
                alert('至少需要2个维度');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/boards`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name,
                        dimensions: newDimensions
                    })
                });
                
                if (response.ok) {
                    // 清空表单
                    document.getElementById('new-board-name').value = '';
                    newDimensions = [];
                    renderNewDimensionsTags();
                    updateCreateButtonState();
                    
                    // 重新加载应用
                    await reloadApp();
                    loadActiveBoardsList();
                    
                    alert('看板创建成功！');
                } else {
                    const error = await response.json();
                    throw new Error(error.detail || '创建失败');
                }
            } catch (error) {
                console.error('创建看板失败:', error);
                alert('创建失败：' + error.message);
            }
        }

        // 重新加载应用（不关闭管理面板）
        async function reloadApp() {
            try {
                // 销毁现有图表
                Object.values(charts).forEach(chart => {
                    if (chart) chart.destroy();
                });
                charts = {};
                
                // 重新加载看板列表
                const response = await fetch(`${API_BASE}/boards`);
                boards = await response.json();
                
                // 重新渲染
                renderNavButtons();
                renderPages();
                
                // 重新初始化每个看板
                for (let i = 0; i < boards.length; i++) {
                    await initBoardDynamic(boards[i]);
                }
                
                // 切换到第一个页面或保持当前页面
                if (boards.length > 0) {
                    const newIndex = Math.min(currentPageIndex, boards.length - 1);
                    switchPage(newIndex);
                }
            } catch (error) {
                console.error('重新加载失败:', error);
            }
        }

        // 点击管理模态框背景关闭
        document.addEventListener('click', function(e) {
            if (e.target.id === 'manage-modal') {
                closeManagePanel();
            }
        });

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
</script>

<!-- 折线图模态框 -->
<div class="modal-overlay" id="line-chart-modal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title" id="modal-dimension-title">维度趋势</div>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-chart">
            <canvas id="line-chart-canvas"></canvas>
        </div>
    </div>
</div>

<!-- 看板管理模态框 -->
<div class="manage-modal" id="manage-modal">
    <div class="manage-panel">
        <div class="manage-header">
            <div class="manage-title">管理看板</div>
            <button class="manage-close" onclick="closeManagePanel()">&times;</button>
        </div>
        <div class="manage-tabs">
            <button class="manage-tab active" onclick="switchManageTab('boards')">所有看板</button>
            <button class="manage-tab" onclick="switchManageTab('deleted')">最近删除</button>
        </div>
        <div class="manage-body">
            <!-- 所有看板页面 -->
            <div class="manage-section active" id="manage-boards">
                <!-- 创建新看板表单 -->
                <div class="create-form">
                    <div class="create-form-title">
                        <span>➕</span> 创建新看板
                    </div>
                    <div class="create-form-group">
                        <label class="create-form-label">看板名称</label>
                        <input type="text" class="create-form-input" id="new-board-name" placeholder="例如：每日习惯">
                    </div>
                    <div class="create-form-group">
                        <label class="create-form-label">维度列表</label>
                        <div class="dimension-tags" id="new-dimensions-tags">
                            <!-- 动态生成维度标签 -->
                        </div>
                        <div class="add-dimension-row">
                            <input type="text" id="new-dimension-input" placeholder="输入维度名称" onkeypress="handleDimensionKeypress(event)">
                            <button class="add-dimension-btn" onclick="addNewDimension()">添加</button>
                        </div>
                    </div>
                    <button class="create-submit-btn" id="create-board-btn" onclick="createNewBoard()" disabled>创建看板</button>
                </div>

                <!-- 看板列表 -->
                <div class="board-list" id="active-boards-list">
                    <!-- 动态生成 -->
                </div>
            </div>

            <!-- 最近删除页面 -->
            <div class="manage-section" id="manage-deleted">
                <div class="board-list" id="deleted-boards-list">
                    <!-- 动态生成 -->
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
